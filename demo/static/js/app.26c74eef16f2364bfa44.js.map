{"version":3,"sources":["webpack:///./src/App.vue?a444","webpack:///./src/App.vue","webpack:///src/App.vue","webpack:///src/plugin/avatarCropper.vue","webpack:///./src/plugin/avatarCropper.vue?7997","webpack:///./src/plugin/avatarCropper.vue","webpack:///./src/plugin/index.js","webpack:///./src/main.js"],"names":["selectortype_template_index_0_src_App","render","_vm","this","_h","$createElement","_c","_self","attrs","id","on","click","$event","show","_v","ok","data","model","value","callback","$$v","expression","staticStyle","display","src","staticRenderFns","src_App","__webpack_require__","normalizeComponent","name","ssrContext","avatarCropper","props","default","showRechoose","img","Image","canvasWidth","canvasHeight","scale","x","y","xLen","yLen","mouseDownX","mouseDownY","mouseIsDownCropper","mouseIsDownDot","watch","document","body","clientWidth","addEventListener","avoidMove","passive","onmousewheel","removeEventListener","methods","e","preventDefault","stopPropagation","resizeCanvas","documentElement","getElementById","style","selectImg","changeImg","_this","target","files","size","reader","FileReader","readAsDataURL","onload","result","showImg","alert","_this2","widthIsLarger","width","height","ctx","getContext","clearRect","drawImage","showMask","mask","left","top","updateMouseDownPos","clientX","clientY","mousedownCropper","mousedownDot","mouseup","moveCropper","_cropper","cropperLen","Number","window","getComputedStyle","getPropertyValue","slice","cropperTop","cropperLeft","touches","offsetX","offsetY","newTop","newLeft","resizeCropper","_cropper2","borderRadius","close","cropper","length","canvas","createElement","$emit","toDataURL","mounted","destroyed","plugin_avatarCropper","directives","rawName","mouseleave","touchend","staticClass","_e","type","accept","change","position","overflow","mousemove","touchmove","mousedown","touchstart","src_plugin_avatarCropper","avatarCropper_normalizeComponent","VueAvatarCropper","install","Vue","component","use","el","h","App"],"mappings":"+JAGeA,GADEC,OAFP,WAAgB,IAAAC,EAAAC,KAAaC,EAAAF,EAAAG,eAA0BC,EAAAJ,EAAAK,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,OAAOC,GAAA,SAAYH,EAAA,UAAeI,IAAIC,MAAA,SAAAC,GAAyBV,EAAAW,MAAA,MAAkBX,EAAAY,GAAA,UAAAZ,EAAAY,GAAA,KAAAR,EAAA,kBAAoDI,IAAIK,GAAA,SAAAH,GAAsBV,EAAAc,KAAAJ,IAAmBK,OAAQC,MAAAhB,EAAA,KAAAiB,SAAA,SAAAC,GAA0ClB,EAAAW,KAAAO,GAAaC,WAAA,UAAoBnB,EAAAY,GAAA,KAAAR,EAAA,OAAwBgB,aAAaC,QAAA,SAAkBf,OAAQgB,IAAAtB,EAAAc,SAAgB,IAE9ZS,oBCChC,IAuBeC,EAvBUC,EAAQ,OAcjCC,ECPAC,KAAA,MACAb,KAFA,WAGA,OACAH,MAAA,EAEAG,KAAA,MDIEhB,GATF,EAVA,SAAA8B,GACEH,EAAQ,SAaV,KAEA,MAUgC,QEwBhCI,GAEAF,KAAA,gBAEAG,OACAd,OACAe,SAAA,IAIAjB,KAVA,WAWA,OAEAkB,cAAA,EAEAC,IAAA,IAAAC,MAGAC,YAAA,IACAC,aAAA,IAGAC,MAAA,EAGAC,EAAA,EACAC,EAAA,EACAC,KAAA,EACAC,KAAA,EAGAC,WAAA,EACAC,WAAA,EAIAC,oBAAA,EAEAC,gBAAA,IAIAC,OACA9B,MADA,WAEAf,KAAAe,OAAA+B,SAAAC,KAAAC,YAAA,KAEAF,SAAAG,iBAAA,YAAAjD,KAAAkD,WAAAC,SAAA,IACAL,SAAAM,aAAApD,KAAAkD,YAGAJ,SAAAO,oBAAA,YAAArD,KAAAkD,WAAAC,SAAA,IACAL,SAAAM,aAAA,QAKAE,SAEAJ,UAFA,SAEAK,GAGA,OAFAA,EAAAC,gBAAAD,EAAAC,iBACAD,EAAAE,iBAAAF,EAAAE,mBACA,GAIAC,aATA,WAUAZ,SAAAC,KAAAC,YAAA,MACAhD,KAAAkC,YAAAlC,KAAAmC,aAAA,GAAAW,SAAAa,gBAAAX,YAGAF,SAAAc,eAAA,UAAAC,MAAAzC,QAAA,eACA0B,SAAAc,eAAA,QAAAC,MAAAzC,QAAA,SAKA0C,UApBA,WAqBAhB,SAAAc,eAAA,aAAApD,SAIAuD,UAzBA,SAyBAR,GAAA,IAAAS,EAAAhE,KACAgC,EAAAuB,EAAAU,OAAAC,MAAA,GAEA,GAAAlC,KAAAmC,MAAA,SAEArB,SAAAc,eAAA,UAAAC,MAAAzC,QAAA,OACA0B,SAAAc,eAAA,QAAAC,MAAAzC,QAAA,QACApB,KAAA+B,cAAA,EAGA,IAAAqC,EAAA,IAAAC,WACAD,EAAAE,cAAAtC,GACAoC,EAAAG,OAAA,WAEAP,EAAAhC,IAAAX,IAAA+C,EAAAI,OAEAR,EAAAS,gBAIAC,MAAA,eAKAD,QAlDA,WAkDA,IAAAE,EAAA3E,KACAA,KAAAgC,IAAAuC,OAAA,WAEA,IAAAK,EAAAD,EAAA3C,IAAA6C,OAAAF,EAAA3C,IAAA8C,OACAH,EAAAvC,MAAAwC,EAAAD,EAAAzC,YAAAyC,EAAA3C,IAAA6C,MAAAF,EAAAxC,aAAAwC,EAAA3C,IAAA8C,OAGAH,EAAApC,KAAAoC,EAAA3C,IAAA6C,MAAAF,EAAAvC,MACAuC,EAAAnC,KAAAmC,EAAA3C,IAAA8C,OAAAH,EAAAvC,MACAuC,EAAAtC,GAAAsC,EAAAzC,YAAAyC,EAAApC,MAAA,EACAoC,EAAArC,GAAAqC,EAAAxC,aAAAwC,EAAAnC,MAAA,EAGA,IAAAuC,EAAAjC,SAAAc,eAAA,OAAAoB,WAAA,MACAD,EAAAE,UAAA,IAAAN,EAAAzC,YAAAyC,EAAAxC,cACA4C,EAAAG,UAAAP,EAAA3C,IAAA,IAAA2C,EAAA3C,IAAA6C,MAAAF,EAAA3C,IAAA8C,OAAAH,EAAAtC,EAAAsC,EAAArC,EAAAqC,EAAApC,KAAAoC,EAAAnC,MAGAmC,EAAAQ,aAKAA,SAzEA,WA2EA,IAAAC,EAAAtC,SAAAc,eAAA,QACAwB,EAAAvB,MAAAwB,KAAArF,KAAAqC,EAAA,KACA+C,EAAAvB,MAAAyB,IAAAtF,KAAAsC,EAAA,KACA8C,EAAAvB,MAAAgB,MAAA7E,KAAAuC,KAAA,KACA6C,EAAAvB,MAAAiB,OAAA9E,KAAAwC,KAAA,MAIA+C,mBAnFA,SAmFAhC,GACAvD,KAAAyC,WAAAc,EAAAiC,QACAxF,KAAA0C,WAAAa,EAAAkC,SAIAC,iBAzFA,SAyFAnC,GACAvD,KAAA2C,qBACA3C,KAAAuF,mBAAAhC,GACAvD,KAAA2C,oBAAA,IAEAgD,aA9FA,SA8FApC,GACAvD,KAAA4C,iBACA5C,KAAAuF,mBAAAhC,GACAvD,KAAA4C,gBAAA,IAIAgD,QArGA,WAsGA5F,KAAA2C,mBAAA3C,KAAA4C,gBAAA,GAIAiD,YA1GA,SA0GAtC,GACA,GAAAvD,KAAA2C,mBAAA,CACA,IAAAmD,EAAAhD,SAAAc,eAAA,WACAmC,EAAAC,OAAAC,OAAAC,iBAAAJ,GAAAK,iBAAA,SAAAC,MAAA,OACAC,EAAAL,OAAAC,OAAAC,iBAAAJ,GAAAK,iBAAA,OAAAC,MAAA,OACAE,EAAAN,OAAAC,OAAAC,iBAAAJ,GAAAK,iBAAA,QAAAC,MAAA,OAEA7C,EAAAiC,UAAAjC,IAAAgD,QAAA,IACA,IAAAC,EAAAjD,EAAAiC,QAAAxF,KAAAyC,WACAgE,EAAAlD,EAAAkC,QAAAzF,KAAA0C,WACA1C,KAAAuF,mBAAAhC,GAMA,IAAAmD,EAAAL,EAAAI,EACAE,EAAAL,EAAAE,EACAE,GAAA,GAAAA,EAAAX,GAAA/F,KAAAwC,MACAmE,GAAA,GAAAA,EAAAZ,GAAA/F,KAAAuC,OACAuD,EAAAjC,MAAAyB,IAAAoB,EAAA,KACAZ,EAAAjC,MAAAwB,KAAAsB,EAAA,QAMAC,cArIA,SAqIArD,GACA,GAAAvD,KAAA4C,eAAA,CAKA5C,KAAA2C,oBAAA,EACA,IAAAkE,EAAA/D,SAAAc,eAAA,WACAmC,EAAAC,OAAAC,OAAAC,iBAAAW,GAAAV,iBAAA,SAAAC,MAAA,OACAC,EAAAL,OAAAC,OAAAC,iBAAAW,GAAAV,iBAAA,OAAAC,MAAA,OACAE,EAAAN,OAAAC,OAAAC,iBAAAW,GAAAV,iBAAA,QAAAC,MAAA,OACA7C,EAAAiC,UAAAjC,IAAAgD,QAAA,IACA,IAAAC,EAAAjD,EAAAiC,QAAAxF,KAAAyC,WAEAzC,KAAAuF,mBAAAhC,GAOAwC,EAAAS,GAAA,IACAH,EAAAN,EAAAS,GAAAxG,KAAAwC,MACA8D,EAAAP,EAAAS,GAAAxG,KAAAuC,OAEAsE,EAAAhD,MAAAgB,MAAAgC,EAAAhD,MAAAiB,OAAAiB,EAAAS,EAAA,KAEAK,EAAAhD,MAAAiD,cAAAf,EAAAS,GAAA,UAMA5F,GAtKA,WAuKA,GAAAZ,KAAAgC,IAAAX,IAAA,CAKArB,KAAA+G,QACA,IAAA1E,EAAA2D,OAAAC,OAAAC,iBAAAc,SAAAb,iBAAA,QAAAC,MAAA,OAAApG,KAAAoC,MACAE,EAAA0D,OAAAC,OAAAC,iBAAAc,SAAAb,iBAAA,OAAAC,MAAA,OAAApG,KAAAoC,MACA6E,EAAAjB,OAAAC,OAAAC,iBAAAc,SAAAb,iBAAA,SAAAC,MAAA,OAAApG,KAAAoC,MACA8E,EAAApE,SAAAqE,cAAA,UACAD,EAAArC,MAAAqC,EAAApC,OAAAmC,EACAC,EAAAlC,WAAA,MACAE,UAAAlF,KAAAgC,IAAAK,EAAAC,EAAA2E,IAAA,IAAAA,KACAjH,KAAAoH,MAAA,KAAAF,EAAAG,kBAXA3C,MAAA,YAeAqC,MAxLA,WAyLA/G,KAAAoH,MAAA,cAIAE,QArPA,WAsPAtH,KAAA0D,eACAuC,OAAAhD,iBAAA,SAAAjD,KAAA0D,cAAA,IAGA6D,UA1PA,WA2PAtB,OAAA5C,oBAAA,SAAArD,KAAA0D,cAAA,KC1Se8D,GADE1H,OAFP,WAAgB,IAAAC,EAAAC,KAAaC,EAAAF,EAAAG,eAA0BC,EAAAJ,EAAAK,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBsH,aAAa/F,KAAA,OAAAgG,QAAA,SAAA3G,MAAAhB,EAAA,MAAAmB,WAAA,UAAkEb,OAASC,GAAA,aAAiBC,IAAKqF,QAAA7F,EAAA6F,QAAA+B,WAAA5H,EAAA6F,QAAAgC,SAAA7H,EAAA6F,WAAuEzF,EAAA,OAAY0H,YAAA,UAAoB1H,EAAA,OAAY0H,YAAA,YAAsB1H,EAAA,UAAe0H,YAAA,SAAAtH,IAAyBC,MAAAT,EAAAgH,SAAmBhH,EAAAY,GAAA,QAAAZ,EAAAY,GAAA,KAAAZ,EAAA,aAAAI,EAAA,UAA6D0H,YAAA,SAAAtH,IAAyBC,MAAAT,EAAA+D,aAAuB/D,EAAAY,GAAA,UAAAZ,EAAA+H,KAAA/H,EAAAY,GAAA,KAAAR,EAAA,UAAqD0H,YAAA,YAAAtH,IAA4BC,MAAAT,EAAAa,MAAgBb,EAAAY,GAAA,UAAAZ,EAAAY,GAAA,KAAAR,EAAA,OAAyC0H,YAAA,iBAA2B1H,EAAA,OAAY0H,YAAA,SAAmB9H,EAAAY,GAAA,gCAAAZ,EAAAY,GAAA,KAAAR,EAAA,UAAkE0H,YAAA,SAAAxH,OAA4BC,GAAA,UAAcC,IAAKC,MAAAT,EAAA+D,aAAuB/D,EAAAY,GAAA,UAAAZ,EAAAY,GAAA,KAAAR,EAAA,SAA2CgB,aAAaC,QAAA,QAAiBf,OAAQC,GAAA,YAAAyH,KAAA,OAAAC,OAAA,sDAA6FzH,IAAK0H,OAAAlI,EAAAgE,aAAwBhE,EAAAY,GAAA,KAAAR,EAAA,OAAwBE,OAAOC,GAAA,UAAaH,EAAA,UAAeE,OAAOC,GAAA,MAAAuE,MAAA9E,EAAAmC,YAAA4C,OAAA/E,EAAAoC,gBAA8DpC,EAAAY,GAAA,KAAAR,EAAA,OAAwBgB,aAAa+G,SAAA,WAAAC,SAAA,UAA0C9H,OAAQC,GAAA,QAAYC,IAAK6H,UAAArI,EAAA6G,cAAAyB,UAAAtI,EAAA6G,iBAA6DzG,EAAA,OAAYE,OAAOC,GAAA,WAAeC,IAAK+H,UAAAvI,EAAA2F,iBAAA0C,UAAArI,EAAA8F,YAAA0C,WAAAxI,EAAA2F,iBAAA2C,UAAAtI,EAAA8F,eAA4H1F,EAAA,OAAYE,OAAOC,GAAA,OAAWC,IAAK+H,UAAAvI,EAAA4F,aAAA4C,WAAAxI,EAAA4F,6BAE3+CrE,oBCChC,IAuBekH,EAvBUhH,EAAQ,OAcjBiH,CACd7G,EACA4F,GAT6B,EAV/B,SAAoB7F,GAClBH,EAAQ,SAaS,kBAEU,MAUG,QChBjBkH,GALbC,QADuB,SACdC,GACPA,EAAIC,UAAU,iBAAkBjH,KCFpCgH,IAAIE,IAAIlH,GAER,IAAIgH,KACFG,GAAI,OACJjJ,OAAQ,SAAAkJ,GAAA,OAAKA,EAAEC","file":"static/js/app.26c74eef16f2364bfa44.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('button',{on:{\"click\":function($event){_vm.show = true}}},[_vm._v(\"更换头像\")]),_vm._v(\" \"),_c('avatar-cropper',{on:{\"ok\":function($event){_vm.data = $event}},model:{value:(_vm.show),callback:function ($$v) {_vm.show=$$v},expression:\"show\"}}),_vm._v(\" \"),_c('img',{staticStyle:{\"display\":\"block\"},attrs:{\"src\":_vm.data}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7ed12c06\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7ed12c06\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7ed12c06\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","<template>\n  <div id=\"app\">\n    <button @click=\"show = true\">更换头像</button>\n    <avatar-cropper v-model=\"show\" @ok=\"data = $event\"></avatar-cropper>\n    <img :src=\"data\" style=\"display: block\">\n  </div>\n</template>\n\n<script>\nexport default {\n  name: 'app',\n  data () {\n    return {\n      show: false,\n\n      data: ''\n    }\n  }\n}\n</script>\n\n<style>\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/App.vue","<template>\n  <!-- container ==> 半透明背景 -->\n  <!-- 鼠标在整个container中松开或离开container时停止拖动 -->\n  <div v-show=\"value\" id=\"container\" @mouseup=\"mouseup\" @mouseleave=\"mouseup\" @touchend=\"mouseup\">\n    <!-- panel ==> 弹出的面板 -->\n    <div class=\"panel\">\n      <!-- 相关按钮 -->\n      <div class=\"buttons\">\n        <button class=\"button\" @click=\"close\">取消</button>\n        <button v-if=\"showRechoose\" class=\"button\" @click=\"selectImg\">重新选择</button>\n        <button class=\"button ok\" @click=\"ok\">确定</button>\n      </div>\n\n      <!-- 选择、显示、编辑面板 -->\n      <div class=\"select-panel\">\n        <div class=\"hint\">只支持JPG、PNG、GIF、SVG，大小不超过5M</div>\n        <button id=\"select\" class=\"button\" @click=\"selectImg\">选择图片</button>\n        <input id=\"inputFile\" type=\"file\" @change=\"changeImg\" style=\"display: none\" accept=\"image/gif,image/jpeg,image/jpg,image/png,image/svg\">\n\n        <!-- 编辑面板、背景接近黑色 -->\n        <div id=\"edit\">\n          <!-- canvas用来显示用户选择的图片 -->\n          <canvas id=\"pic\" :width=\"canvasWidth\" :height=\"canvasHeight\"></canvas>\n          <!-- 浅白色蒙版 -->\n          <div id=\"mask\"\n           style=\"position: absolute; overflow: hidden\"\n           @mousemove=\"resizeCropper\"\n           @touchmove=\"resizeCropper\"\n          >\n            <!-- cropper ==> 选择框，圆形透明镂空 -->\n            <div id=\"cropper\"\n             @mousedown=\"mousedownCropper\"\n             @mousemove=\"moveCropper\"\n             @touchstart=\"mousedownCropper\"\n             @touchmove=\"moveCropper\"\n            >\n              <!-- dot ==> 用于改变大小 -->\n              <div id=\"dot\"\n               @mousedown=\"mousedownDot\"\n               @touchstart=\"mousedownDot\"\n              ></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n\n  name: 'avatarCropper',\n\n  props: {\n    value: {\n      default: true\n    }\n  },\n\n  data () {\n    return {\n      // 是否显示重新选择\n      showRechoose: false,\n      // 存储用户选择的图片\n      img: new Image(),\n\n      // 图片画布的宽高\n      canvasWidth: 450,\n      canvasHeight: 450,\n\n      // 缩放比例， 显示/实际\n      scale: 1.0,\n\n      // 缩放后起点坐标和宽高\n      x: 0,\n      y: 0,\n      xLen: 0,\n      yLen: 0,\n\n      // 鼠标按下时的坐标\n      mouseDownX: 0,\n      mouseDownY: 0,\n\n      // 鼠标是否正在按下\n      // cropper内\n      mouseIsDownCropper: false,\n      // dot处\n      mouseIsDownDot: false\n    }\n  },\n\n  watch: {\n    value () {\n      if (this.value && document.body.clientWidth < 768) {\n        // 移动端开启此插件时禁止拖动和滚轮事件\n        document.addEventListener('touchmove', this.avoidMove, {passive: false})\n        document.onmousewheel = this.avoidMove\n      } else {\n        // 此插件关闭时enable拖动和滚轮事件\n        document.removeEventListener('touchmove', this.avoidMove, {passive: false})\n        document.onmousewheel = null\n      }\n    }\n  },\n\n  methods: {\n    // 用于移动端适配，禁止拖动\n    avoidMove (e) {\n      e.preventDefault && e.preventDefault()\n      e.stopPropagation && e.stopPropagation()\n      return false\n    },\n\n    // 用于移动端适配， 设备宽度变化时调节画布宽高\n    resizeCanvas () {\n      if (document.body.clientWidth < 768) {\n        this.canvasWidth = this.canvasHeight = document.documentElement.clientWidth * 0.9\n\n        // 显示选择按钮，隐藏编辑面板\n        document.getElementById('select').style.display = 'inline-block'\n        document.getElementById('edit').style.display = 'none'\n      }\n    },\n\n    // 弹出选择文件窗口\n    selectImg () {\n      document.getElementById('inputFile').click()\n    },\n\n    // 当用户选择文件后调整显示的图片和蒙版\n    changeImg (e) {\n      const img = e.target.files[0]\n      // 限制图片不超过5M\n      if (img && img.size <= 5 * 1024 * 1024) {\n        // 隐藏选择按钮，显示编辑面板\n        document.getElementById('select').style.display = 'none'\n        document.getElementById('edit').style.display = 'block'\n        this.showRechoose = true\n\n        // 获取用户选择的图片数据\n        const reader = new FileReader()\n        reader.readAsDataURL(img)\n        reader.onload = () => {\n          // 修改显示的图片数据\n          this.img.src = reader.result\n          // 显示图片\n          this.showImg()\n        }\n      } else {\n        // 超过5M提醒\n        alert('图片不可以超过5M！')\n      }\n    },\n\n    // 显示图片\n    showImg () {\n      this.img.onload = () => {\n        // 缩放比以较长的那个边为准\n        const widthIsLarger = this.img.width >= this.img.height\n        this.scale = widthIsLarger ? this.canvasWidth / this.img.width : this.canvasHeight / this.img.height\n\n        // 计算显示图片的左上角坐标和缩放后宽高\n        this.xLen = this.img.width * this.scale\n        this.yLen = this.img.height * this.scale\n        this.x = (this.canvasWidth - this.xLen) / 2\n        this.y = (this.canvasHeight - this.yLen) / 2\n\n        // 显示缩放后的图片\n        const ctx = document.getElementById('pic').getContext('2d')\n        ctx.clearRect(0, 0, this.canvasWidth, this.canvasHeight)\n        ctx.drawImage(this.img, 0, 0, this.img.width, this.img.height, this.x, this.y, this.xLen, this.yLen)\n\n        // 显示蒙版\n        this.showMask()\n      }\n    },\n\n    // 显示蒙版\n    showMask () {\n      // 调整蒙版位置\n      const mask = document.getElementById('mask')\n      mask.style.left = this.x + 'px'\n      mask.style.top = this.y + 'px'\n      mask.style.width = this.xLen + 'px'\n      mask.style.height = this.yLen + 'px'\n    },\n\n    // 更新鼠标坐标\n    updateMouseDownPos (e) {\n      this.mouseDownX = e.clientX\n      this.mouseDownY = e.clientY\n    },\n\n    // 按下鼠标时记录鼠标坐标并更新mouseIsDown\n    mousedownCropper (e) {\n      if (this.mouseIsDownCropper) return\n      this.updateMouseDownPos(e)\n      this.mouseIsDownCropper = true\n    },\n    mousedownDot (e) {\n      if (this.mouseIsDownDot) return\n      this.updateMouseDownPos(e)\n      this.mouseIsDownDot = true\n    },\n\n    // 松开鼠标时更新mouseIsDown为false,结束拖动\n    mouseup () {\n      this.mouseIsDownCropper = this.mouseIsDownDot = false\n    },\n\n    // 移动cropper\n    moveCropper (e) {\n      if (this.mouseIsDownCropper) {\n        const cropper = document.getElementById('cropper')\n        const cropperLen = Number(window.getComputedStyle(cropper).getPropertyValue('width').slice(0, -2))\n        const cropperTop = Number(window.getComputedStyle(cropper).getPropertyValue('top').slice(0, -2))\n        const cropperLeft = Number(window.getComputedStyle(cropper).getPropertyValue('left').slice(0, -2))\n        // 移动端适配\n        if (!e.clientX) e = e.touches[0]\n        const offsetX = e.clientX - this.mouseDownX\n        const offsetY = e.clientY - this.mouseDownY\n        this.updateMouseDownPos(e)\n        /* 当\n         * 0 <= top + len + offsetY <= yLen\n         * 0 <= left + len + offsetX <= xLen\n         * 时，移动cropper\n         */\n        const newTop = cropperTop + offsetY\n        const newLeft = cropperLeft + offsetX\n        if (newTop >= 0 && newTop + cropperLen <= this.yLen\n         && newLeft >= 0 && newLeft + cropperLen <= this.xLen) {\n          cropper.style.top = newTop + 'px'\n          cropper.style.left = newLeft + 'px'\n        }\n      }\n    },\n\n    // 修改cropper大小\n    resizeCropper (e) {\n      if (this.mouseIsDownDot) {\n        /*\n         * resize优先，因此在mouseIsDownDot为true时\n         * 设mouseIsDownCropper为false\n         */\n        this.mouseIsDownCropper = false\n        const cropper = document.getElementById('cropper')\n        const cropperLen = Number(window.getComputedStyle(cropper).getPropertyValue('width').slice(0, -2))\n        const cropperTop = Number(window.getComputedStyle(cropper).getPropertyValue('top').slice(0, -2))\n        const cropperLeft = Number(window.getComputedStyle(cropper).getPropertyValue('left').slice(0, -2))\n        if (!e.clientX) e = e.touches[0]\n        const offsetX = e.clientX - this.mouseDownX\n        // const offsetY = e.clientY - this.mouseDownY\n        this.updateMouseDownPos(e)\n        /* 当\n         * len + offsetX >= 30\n         * top + len + offsetX <= yLen\n         * left + len + offsetX <= xLen\n         * 时，resize cropper\n         */\n        if (cropperLen + offsetX >= 30\n         && cropperTop + cropperLen + offsetX <= this.yLen\n         && cropperLeft + cropperLen + offsetX <= this.xLen) {\n          // 宽高均为len + offsetX\n          cropper.style.width = cropper.style.height = cropperLen + offsetX + 'px'\n          // border-radius为宽高的一半\n          cropper.style.borderRadius = (cropperLen + offsetX) / 2 + 'px'\n        }\n      }\n    },\n\n    // 用户选定后，传出选定的dataUrl\n    ok () {\n      if (!this.img.src) {\n        // 如果未选择图片\n        alert('请先选择图片！')\n        return\n      }\n      this.close()\n      const x = Number(window.getComputedStyle(cropper).getPropertyValue('left').slice(0, -2)) / this.scale\n      const y = Number(window.getComputedStyle(cropper).getPropertyValue('top').slice(0, -2)) / this.scale\n      const length = Number(window.getComputedStyle(cropper).getPropertyValue('width').slice(0, -2)) / this.scale\n      const canvas = document.createElement('canvas')\n      canvas.width = canvas.height = length\n      const ctx = canvas.getContext('2d')\n      ctx.drawImage(this.img, x, y, length, length, 0, 0, length, length)\n      this.$emit('ok', canvas.toDataURL())\n    },\n\n    // 关闭本插件\n    close () {\n      this.$emit('input', false)\n    }\n  },\n\n  mounted () {\n    this.resizeCanvas()\n    window.addEventListener('resize', this.resizeCanvas, false)\n  },\n\n  destroyed () {\n    window.removeEventListener('resize', this.resizeCanvas, false)\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n#container {\n  position: fixed;\n  top: 0;\n  right: 0;\n  left: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.3);\n  // 用户不可选\n  user-select: none;\n  z-index: 9999;\n}\n\n.panel {\n  position: fixed;\n  width: 100vw;\n  height: 120vw;\n  top: calc(50vh - 60vw);\n  border-radius: 5px;\n  background-color: white;\n}\n\n.buttons {\n  width: 100%;\n  height: 56px;\n  margin-bottom: 20px;\n  background-color: #f2f2f5;\n  text-align: center;\n}\n\n.button {\n  margin: 11px 5px;\n  padding: 0 15px;\n  border: 0;\n  border-radius: 2px;\n  height: 34px;\n  line-height: 35px;\n  background-color: #fff;\n  color: #515a6e;\n  font-size: 14px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.25);\n  text-decoration: none;\n  outline: none;\n  cursor: pointer;\n}\n\n.ok {\n  background-color: #2d8cf0;\n  color: #fff;\n}\n\n.select-panel {\n  width: 90vw;\n  height: 90vw;\n  margin: 5vw;\n  background-color: #f2f2f5;\n}\n\n.hint {\n  position: absolute;\n  top: 60px;\n  width: 90vw;\n  text-align: center;\n  color: #515a6e;\n  font-size: 12px;\n}\n\n#select {\n  position: absolute;\n  left: calc(50vw - 43px);\n  top: calc(60vw - 17px);\n}\n\n#edit {\n  display: none;\n  position: absolute;\n  width: 90vw;\n  height: 90vw;\n  background-color: #333;\n}\n\n#cropper {\n  display: inline-block;\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100px;\n  height: 100px;\n  border-radius: 50px;\n  box-shadow: 0 0 0 500px rgba(255, 255, 255, 0.6);\n  cursor: move;\n}\n\n#dot {\n  display: inline-block;\n  position: absolute;\n  top: 50%;\n  right: -4px;\n  border: 1px solid gray;\n  width: 7px;\n  height: 7px;\n  border-radius: 4px;\n  background-color: #fff;\n  cursor: w-resize;\n}\n\n@media screen and (min-width: 768px) {\n  .panel {\n    width: 500px;\n    height: 556px;\n    top: calc(50vh - 270px);\n    left: calc(50vw - 270px);\n  }\n\n  .select-panel {\n    width: 450px;\n    height: 450px;\n    margin: 25px;\n    background-color: #f2f2f5;\n  }\n\n  .hint {\n    width: 450px;\n  }\n\n  #select {\n    left: 207px;\n    top: 250px;\n  }\n\n  #edit {\n    width: 450px;\n    height: 450px;\n  }\n}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/plugin/avatarCropper.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.value),expression:\"value\"}],attrs:{\"id\":\"container\"},on:{\"mouseup\":_vm.mouseup,\"mouseleave\":_vm.mouseup,\"touchend\":_vm.mouseup}},[_c('div',{staticClass:\"panel\"},[_c('div',{staticClass:\"buttons\"},[_c('button',{staticClass:\"button\",on:{\"click\":_vm.close}},[_vm._v(\"取消\")]),_vm._v(\" \"),(_vm.showRechoose)?_c('button',{staticClass:\"button\",on:{\"click\":_vm.selectImg}},[_vm._v(\"重新选择\")]):_vm._e(),_vm._v(\" \"),_c('button',{staticClass:\"button ok\",on:{\"click\":_vm.ok}},[_vm._v(\"确定\")])]),_vm._v(\" \"),_c('div',{staticClass:\"select-panel\"},[_c('div',{staticClass:\"hint\"},[_vm._v(\"只支持JPG、PNG、GIF、SVG，大小不超过5M\")]),_vm._v(\" \"),_c('button',{staticClass:\"button\",attrs:{\"id\":\"select\"},on:{\"click\":_vm.selectImg}},[_vm._v(\"选择图片\")]),_vm._v(\" \"),_c('input',{staticStyle:{\"display\":\"none\"},attrs:{\"id\":\"inputFile\",\"type\":\"file\",\"accept\":\"image/gif,image/jpeg,image/jpg,image/png,image/svg\"},on:{\"change\":_vm.changeImg}}),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"edit\"}},[_c('canvas',{attrs:{\"id\":\"pic\",\"width\":_vm.canvasWidth,\"height\":_vm.canvasHeight}}),_vm._v(\" \"),_c('div',{staticStyle:{\"position\":\"absolute\",\"overflow\":\"hidden\"},attrs:{\"id\":\"mask\"},on:{\"mousemove\":_vm.resizeCropper,\"touchmove\":_vm.resizeCropper}},[_c('div',{attrs:{\"id\":\"cropper\"},on:{\"mousedown\":_vm.mousedownCropper,\"mousemove\":_vm.moveCropper,\"touchstart\":_vm.mousedownCropper,\"touchmove\":_vm.moveCropper}},[_c('div',{attrs:{\"id\":\"dot\"},on:{\"mousedown\":_vm.mousedownDot,\"touchstart\":_vm.mousedownDot}})])])])])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-bedb87a0\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/plugin/avatarCropper.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-bedb87a0\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!less-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./avatarCropper.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./avatarCropper.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./avatarCropper.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-bedb87a0\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./avatarCropper.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-bedb87a0\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/plugin/avatarCropper.vue\n// module id = null\n// module chunks = ","'use strict'\n\nimport avatarCropper from './avatarCropper.vue'\n\nconst VueAvatarCropper = {\n  install (Vue) {\n    Vue.component('avatar-cropper', avatarCropper)\n  }\n}\n\nexport default VueAvatarCropper\n\n\n// WEBPACK FOOTER //\n// ./src/plugin/index.js","import Vue from 'vue'\nimport App from './App.vue'\n\nimport avatarCropper from './plugin/index.js'\nVue.use(avatarCropper)\n\nnew Vue({\n  el: '#app',\n  render: h => h(App)\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}